<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width" />

    <link rel="shortcut icon" href="http://patxipierce.com/img/favicons/favicon.ico"/>

    <title>RaSyEn - Random Syntax Engine Tests</title>

    <meta name="description" content="RaSyEn is a Random Syntax Engine" />
    <meta name="keywords" content="random generation, random syntax engine, random phrase generator" />

    <style type="text/css">
        body {
            margin: 0; 
            padding: 0;
            color: #ddd;
            font-family: Hack, "Andale Mono", "Lucida Console", Helvetica, Arial, monospace;
            font-size: 90%;

            background-color: #7d7e7d; /* Fallback */
            background-image: -webkit-gradient(linear, left top, left bottom, from(#7d7e7d), to(#0e0e0e));
            background-image: -webkit-linear-gradient(top, #7d7e7d 0%, #0e0e0e 100%);
            background-image:    -moz-linear-gradient(top, #7d7e7d 0%, #0e0e0e 100%);
            background-image:     -ms-linear-gradient(top, #7d7e7d 0%, #0e0e0e 100%);
            background-image:      -o-linear-gradient(top, #7d7e7d 0%, #0e0e0e 100%);
            background-image:         linear-gradient(to bottom, #7d7e7d 0%, #0e0e0e 100%);
            
            background-repeat: no-repeat;
            background-attachment: fixed;

            min-height: 100%;
        }
        a { color: #fff; }
        header pre { font-size: 9px; }
        footer,
        header { margin: 15px 0; background-color: #111; text-align: center; }
        input { background-color: #111; color: #ddd; text-align: center; width: 100%; max-width: 320px; border: 1px solid #ddd; padding: 5px 0; }
        button { padding: 15px 0; border-radius: 4px; font-size: 140%; width: 100%; background-color: #111; color: #ddd; border: 1px solid #ddd; cursor: pointer; }
        button:hover { background-color: #444; color: #fff; }
        header,
        #main { padding: 2%; }
        #tests { padding: 0; margin: 0; }
        #tests li { text-align: center; border-bottom: 1px solid #aaa; list-style: none; }
        #tests p { font-size: 140%; }
        ul.inline > li { display: inline; }
        footer nav ul li { list-style: none; text-align: right; padding: 15px; }
    </style>
</head>
<body>

    <div id="main">
        <header>
            <pre>__________          _________      ___________       
\______   \_____   /   _____/__.__.\_   _____/ ____  
 |       _/\__  \  \_____  <   |  | |    __)_ /    \ 
 |    |   \ / __ \_/        \___  | |        \   |  \
 |____|_  /(____  /_______  / ____|/_______  /___|  /
        \/      \/        \/\/             \/     \/ </pre>

            <h1>Random Syntax Engine Tests:</h1>
        </header>

        <section>        
            <h2>List data in use:</h2>        
            <div id="lists"></div>


            <button onclick="test_all();">Test Again...</button>

            <ul id="tests">
                <li>
                    <h3>Simple test</h3>
                    <input type="text" id="simple-test-tpl" value="%number% %digit%">
                    <p id="simple-test-out"></p>
                </li>
                <li>
                    <h3>Category test</h3>
                    <input type="text" id="category-test-tpl" value="%geography@water% %geography@land%">
                    <p id="category-test-out"></p>
                </li>
                <li>
                    <h3>Concatenation test</h3>
                    <input type="text" id="concatenation-test-tpl" value="%number|digit% %geography@water|geography@land%">
                    <p id="concatenation-test-out"></p>
                </li>
                <li>
                    <h3>Filter test</h3>
                    <input type="text" id="filter-test-tpl" value="%geography@water=to-upper% %geography@land=first-to-upper%">
                    <p id="filter-test-out"></p>
                </li>
                <li>
                    <h3>Custom Filter test</h3>
                    <input type="text" id="custom-filter-test-tpl" value=" %geography=plural%">
                    <p id="custom-filter-test-out"></p>
                </li>
                <li>
                    <h3>Automatic Filter test</h3>
                    <input type="text" id="auto-filter-test-tpl" value="%colours%">
                    <p id="auto-filter-test-out"></p>
                </li>
                <li>
                    <h3>Filter save-result, random-category and category test (uses params)</h3>
                    <input type="text" id="filter-save-test-tpl" value="%geography=random-category=save-result=saved-key% %geography=category=saved-key%">
                    <p id="filter-save-test-out"></p>
                </li>
                <li>
                    <h3>Filter alone test (uses params)</h3>
                    <input type="text" id="filter-alone-test-tpl" value="%=range=2-24%">
                    <p id="filter-alone-test-out"></p>
                </li>
                <li>
                    <h3>Tag meta filter test</h3>
                    <input type="text" id="tag-meta-test-tpl" value="Its %animal=meta=a-or-an%">
                    <p id="tag-meta-test-out"></p>
                </li>
                <li>
                    <h3>Callback test:</h3>
                    <p>Parse: <span id="count-parse">0</span>, Templates: <span id="count-templates">0</span>, Tags: <span id="count-tags">0</span>.</p>
                </li>
            </ul>

            <button onclick="test_all();">Test Again...</button>
        </section>
    </div>
    <footer>
        <nav>
            <ul>
                <li><a href="https://github.com/patxipierce/rasyen">Fork RaSyEn on Github.</a></li>
            </ul>
    </footer>

    <script src="rasyen.js"></script>
    <script>

    // Load test lists
    function load_lists(){
        Rasyen.list_load( "number", ["one","two","three"]);
        Rasyen.list_load( "digit", ["1","2","3"]);
        Rasyen.list_load( "geography", { 
            "water" : ["gulf","lake","river","sea","ocean"],
            "land" : ["cliff","desert","canyon","mountain"]
        });
        Rasyen.list_load( "colours", [
                ["red", "#c00"],
                ["green", "#0c0"],
                ["blue", "#00c"]
        ]);
        Rasyen.list_load( "animal", [
            "%colours% dog %animal%",
            "%colours% cat",
            "goat from the %geography@land%",
            "goldfish from the %geography@water%"
        ]);
    }

    // Load the filters
    function load_filters(){
        // Load custom filters
        Rasyen.filters['plural'] = function(list){
            list.replace = list.replace+'s';
            return list;
        }

        // The filter "colours" is called the same name as the "colours" list,
        // so it will be applied automatically when the %colours% tag is called.
        Rasyen.filters['colours'] = function(list){
            if(typeof Rasyen.lists['colours'] !== 'undefined'){
                var color_list = Rasyen.list_get('colours');
                var col = Rasyen.rai(color_list);
                list.replace = '<span style="color:'+col[1]+';">'+col[0]+'</span>';
            }
            return list;
        }

        // Will select a random number between two numbers.
        Rasyen.filters['range'] = function(list){
            var ranges = [1,64]; // default random range

            if(list.filter.length >= 2){
                ranges = list.filter[1].split('-').map(function(x) {
                   return Number(x);
                });
            }
            list.replace = Rasyen.random_range(ranges[0], ranges[1]);
            return list;
        }
    }

    // Load all the callbacks
    function load_callbacks(){
        // Will run once for every parse call
        Rasyen.callback.parse = function(parsed){

            var parse_count = document.getElementById('count-parse'); 
            parse_count.innerHTML = Number(parse_count.innerHTML) + 1;

            return parsed;
        }

        // Will run once for every template
        Rasyen.callback.parse_template = function(parsed){
            
            var tpl_count = document.getElementById('count-templates'); 
            tpl_count.innerHTML = Number(tpl_count.innerHTML) + 1;

            return parsed;
        }

        // Will run on every tag of a template
        Rasyen.callback.parse_tag = function(parsed){

            var tag_count = document.getElementById('count-tags'); 
            tag_count.innerHTML = Number(tag_count.innerHTML) + 1;

            return parsed;
        }
    }


    function show_lists(){

        function json_to_ul(obj, parent) {
            // Create the list element
            if(typeof parent == 'undefined'){
                parent = document.createElement('ul');
                first = parent;
            }

            if(obj instanceof Array){
                parent.className = "inline";
                for(var i = 0; i < obj.length; i++) {
                    parent.appendChild(json_to_ul(obj[i], document.createElement('li')));   
                };
            }else if(obj instanceof Object){
                for(key in obj){
                    if(!obj.hasOwnProperty(key)) continue;
                    var new_li = document.createElement('li');
                    if(parent == first){
                        new_li.appendChild(document.createTextNode( "%"+key+"%" ));
                    }else{
                        new_li.appendChild(document.createTextNode( "@"+key ));
                    }
                    new_li.appendChild( json_to_ul(obj[key], document.createElement('ul')) );
                    parent.appendChild(new_li);
                }
            }else{
                // Set its contents 
                // does not check for other wonderful js types 
                parent.appendChild(
                    document.createElement('span').appendChild(
                        document.createTextNode( '"'+obj+'",' )
                    )
                );
            }
            return parent;
        }

        var lists = json_to_ul(Rasyen.lists);
        document.getElementById('lists').appendChild(lists);
    }

    function test_all(){
        // Array test
        document.getElementById('simple-test-out').innerHTML = Rasyen.parse(document.getElementById('simple-test-tpl').value);

        // Object test
        document.getElementById('category-test-out').innerHTML = Rasyen.parse(document.getElementById('category-test-tpl').value);

        // Combining lists
        document.getElementById('concatenation-test-out').innerHTML = Rasyen.parse(document.getElementById('concatenation-test-tpl').value);

        // Test filters    
        document.getElementById('filter-test-out').innerHTML = Rasyen.parse(document.getElementById('filter-test-tpl').value);

        // Test custom filters
        document.getElementById('custom-filter-test-out').innerHTML = Rasyen.parse(document.getElementById('custom-filter-test-tpl').value);

        // Test automatic list filters
        document.getElementById('auto-filter-test-out').innerHTML = Rasyen.parse(document.getElementById('auto-filter-test-tpl').value);

        // Test filters    
        document.getElementById('filter-save-test-out').innerHTML = Rasyen.parse(document.getElementById('filter-save-test-tpl').value);

        // Test running filters with no list
        document.getElementById('filter-alone-test-out').innerHTML = Rasyen.parse(document.getElementById('filter-alone-test-tpl').value);

        // Test meta filter
        document.getElementById('tag-meta-test-out').innerHTML = Rasyen.parse(document.getElementById('tag-meta-test-tpl').value);
    }

    function rasyen_tests_init(){
        load_lists();
        
        load_filters();

        load_callbacks();
        
        // Start
        show_lists();
        test_all();
    }

    window.onload = rasyen_tests_init;

    </script>
</body>
</html>