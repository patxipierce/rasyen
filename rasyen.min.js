/*
*
*   RaSyEn - Random Syntax Engine v1.1
*
*/
var Rasyen={lists:{},callback:{parse:function(parsed){return parsed},parse_template:function(parsed){return parsed},parse_tag:function(parsed){return parsed}},filters:{'a-or-an':function(list){if(typeof list.replace==='string'){list.replace='a'+(('aeiou'.indexOf(list.replace.charAt(0).toLowerCase())==-1)?'':'n')+' '+list.replace}return list},'first-to-upper':function(list){if(typeof list.replace==='string'){list.replace=list.replace.charAt(0).toUpperCase()+list.replace.slice(1)}return list},'first-to-lower':function(list){if(typeof list.replace==='string'){list.replace=list.replace.charAt(0).toLowerCase()+list.replace.slice(1)}return list},'to-upper':function(list){if(typeof list.replace==='string'){list.replace=list.replace.toUpperCase()}return list},'to-lower':function(list){if(typeof list.replace==='string'){list.replace=list.replace.toLowerCase()}return list}},random_range:function(min,max){if(typeof window.crypto=='object'){var range=max-min;if(range<=0){return false}var requestBytes=Math.ceil(Math.log2(range)/8);if(!requestBytes){return min}var maxNum=Math.pow(256,requestBytes);var ar=new Uint8Array(requestBytes);while(true){window.crypto.getRandomValues(ar);var val=0;for(var i=0;i<requestBytes;i+=1){val=(val<<8)+ar[i]}if(val+range-(val%range)<maxNum){return min+(val%range)}}}else{return Math.floor(Math.random()*(max-min+1))+min}},rai:function(items){return items[this.random_range(0,items.length)]},roi:function(obj){var keys=Object.keys(obj);return obj[keys[this.random_range(0,keys.length)]]},random_str:function(data){if(data instanceof Array){data=this.random_str(this.rai(data))}else if(data instanceof Object){data=this.random_str(this.roi(data))}return data},navigate_obj:function(arr,obj){var n=0;while(obj.hasOwnProperty(arr[n])){obj=obj[arr[n]];n+=1}return obj},list_load:function(list_name,data){if(typeof list_name=='string'&&typeof data=='object'){this.lists[list_name]=data;return true}else{return false}},list_remove:function(list_name){if(this.lists.hasOwnProperty(list_name)){delete this.lists[list_name];return true}else{return false}},list_get:function(list_name){if(this.lists.hasOwnProperty(list_name)){return this.lists[list_name]}else{return false}},parse_tag:function(tag){var cmd=tag.slice(1,-1);var list_tags=cmd.split('|');var lists=[];for(var i=0;i<list_tags.length;i+=1){var list={name:list_tags[i],categories:false,replace:false,filter:false};var fns=list.name.split('=');if(fns.length>1){list.name=fns.shift();list.filter=fns}var cats=list.name.split('@');if(cats.length>1){list.name=cats.shift();list.categories=[];for(var n=0;n<cats.length;n+=1){list.categories.push(cats[n])}}if(this.lists.hasOwnProperty(list.name)){if(list.categories){list.replace=this.random_str(this.navigate_obj(list.categories,this.lists[list.name]))}else{list.replace=this.random_str(this.lists[list.name])}}if(typeof this.filters[list.name]=='function'){list=this.filters[list.name](list)}if(list.filter){for(var n=0;n<list.filter.length;n+=1){var fn=list.filter[n];if(typeof this.filters[fn]==='function'){list=this.filters[fn](list)}}}lists.push(list)}output=[];for(var i=0;i<lists.length;i+=1){if(lists[i].replace){output.push(lists[i].replace)}}return this.callback.parse_tag({tag:tag,output:(output.length)?this.rai(output):tag,parsed:lists})},parse_template:function(tpl){var tags=tpl.match(/%(.*?)%/g);if(!tags){return tpl}var parsed={template:tpl,parsed_tags:[]};var tags_len=tags.length;for(var i=0;i<tags_len;i+=1){var tag=tags[i];parsed.parsed_tags.push(this.parse_tag(tag))}return this.callback.parse_template(parsed)},parse:function(tpl){var parsed_tpl=this.parse_template(tpl);if(parsed_tpl.hasOwnProperty('parsed_tags')){for(var i=0;i<parsed_tpl.parsed_tags.length;i+=1){var parsed_tag=parsed_tpl.parsed_tags[i];var clean_tag=new RegExp(parsed_tag.tag.replace(/([\!\$\(\)\*\+\.\/\:\=\?\[\\\]\^\{\|\}])/g,"\\$1"));tpl=tpl.replace(clean_tag,parsed_tag.output)}}this.callback.parse(parsed_tpl);return tpl}};