/*
*
*   RaSyEn - Random Syntax Engine v1.7
*
*/
var Rasyen={version:'1.7',lists:{},saved_keys:[],removed_items:[],options:{max_recusrion:10},callback:{parse:function(parsed){return parsed},parse_template:function(parsed){return parsed},parse_tag:function(parsed){return parsed}},filters:{'a-or-an':function(list){if(typeof list.replace==='string'&&list.replace!==''){list.replace='a'+(('aeiou'.indexOf(list.replace.charAt(0).toLowerCase())==-1)?'':'n')+' '+list.replace}return list},'first-to-upper':function(list){if(typeof list.replace==='string'&&list.replace!==''){list.replace=list.replace.charAt(0).toUpperCase()+list.replace.slice(1)}return list},'first-to-lower':function(list){if(typeof list.replace==='string'&&list.replace!==''){list.replace=list.replace.charAt(0).toLowerCase()+list.replace.slice(1)}return list},'to-upper':function(list){if(typeof list.replace==='string'&&list.replace!==''){list.replace=list.replace.toUpperCase()}return list},'to-lower':function(list){if(typeof list.replace==='string'&&list.replace!==''){list.replace=list.replace.toLowerCase()}return list},'words':function(list){if(typeof list.replace==='string'&&list.replace.length!==''){var idx=list.filter.indexOf('words')+1;if(list.filter.length>=idx){var params=list.filter.slice(idx*-1);list.replace=list.replace.split(' ').map(function(w){for(var i=0;i<params.length;i+=1){if(Rasyen.filters.hasOwnProperty(params[i])){w=Rasyen.filters[params[i]]({name:list.name,categories:list.categories,replace:w,filter:params[i]}).replace}}return w}).join(' ')}}return list},'random-category':function(list){if(Rasyen.lists.hasOwnProperty(list.name)&&Rasyen.lists[list.name]instanceof Object&&Object.keys(Rasyen.lists[list.name]).length>0){list.replace=Rasyen.rok(Rasyen.lists[list.name])}return list},'save-result':function(list){if(typeof list.replace==='string'){var saved_key=list.filter[list.filter.indexOf('save-result')+1];if(typeof saved_key=='string'){Rasyen.list_save_item(list.replace,saved_key)}}return list},'category':function(list){var saved_key=list.filter[list.filter.indexOf('category')+1];if(typeof saved_key=='string'&&typeof Rasyen.lists[saved_key]=='object'){var list_key=Rasyen.random_str(Rasyen.lists[saved_key]);if(typeof Rasyen.lists[list.name][list_key]=='object'){list.categories=[list_key];list.replace=Rasyen.random_str(Rasyen.lists[list.name][list_key])}}return list},'remove-result':function(list){if(typeof list.replace=='string'){Rasyen.list_remove_item(list.name,list.replace,list.categories)}return list},'meta':function(list){var max=Rasyen.options.max_recusrion;var tags=list.replace.match(/%(.*?)%/g);if(tags&&tags.length){for(var i=0;i<max;i+=1){list.replace=Rasyen.parse(list.replace);tags=list.replace.match(/%(.*?)%/g);if(!tags){break}}}return list}},random_range:function(min,max){if(typeof window.crypto=='object'){var range=max-min;if(range<=0){return false}var requestBytes=Math.ceil(Math.log2(range)/8);if(!requestBytes){return min}var maxNum=Math.pow(256,requestBytes);var ar=new Uint8Array(requestBytes);while(true){window.crypto.getRandomValues(ar);var val=0;for(var i=0;i<requestBytes;i+=1){val=(val<<8)+ar[i]}if(val+range-(val%range)<maxNum){return min+(val%range)}}}else{return Math.floor(Math.random()*(max-min+1))+min}},rai:function(items){return items[this.random_range(0,items.length)]},roi:function(obj){var keys=Object.keys(obj);return obj[keys[this.random_range(0,keys.length)]]},rok:function(obj){var keys=Object.keys(obj);return keys[this.random_range(0,keys.length)]},random_str:function(data){if(data instanceof Array){data=this.random_str(this.rai(data))}else if(data instanceof Object){data=this.random_str(this.roi(data))}return data},navigate_obj:function(obj,arr){var n=0;while(obj.hasOwnProperty(arr[n])){obj=obj[arr[n]];n+=1}return obj},extend_obj:function(){for(var i=1;i<arguments.length;i+=1){for(var key in arguments[i]){if(arguments[i].hasOwnProperty(key)){if(typeof arguments[0][key]==='object'&&typeof arguments[i][key]==='object'){this.extend_obj(arguments[0][key],arguments[i][key])}else{arguments[0][key]=arguments[i][key]}}}}return arguments[0]},replace_in_obj:function(old_obj,rep,arr){var new_obj=temp={};for(var i=0;i<arr.length;i+=1){if(arr.length-1==i){temp=temp[arr[i]]=rep}else{temp=temp[arr[i]]={}}}return this.extend_obj(old_obj,new_obj)},list_save_item:function(result,name){this.saved_keys.push(name);if(typeof this.lists[name]=='undefined'){this.lists[name]=[]}Rasyen.lists[name].push(result)},list_remove_item:function(list_name,str,arr){if(this.lists.hasOwnProperty(list_name)){var data,do_rebuild=false;if(arr instanceof Array&&this.lists[list_name]instanceof Object){data=this.navigate_obj(this.lists[list_name],arr);do_rebuild=true}else{data=this.lists[list_name]}if(data instanceof Array){var pos=data.indexOf(str);if(pos!=-1){data.splice(pos,1);Rasyen.removed_items.push({'path':arr,'str':str,'pos':pos,'list_name':list_name})}}if(do_rebuild){this.lists[list_name]=this.replace_in_obj(this.lists[list_name],data,arr)}}},list_load:function(list_name,data){if(typeof list_name=='string'&&typeof data=='object'){this.lists[list_name]=data;return true}else{return false}},lists_load:function(lists_obj){for(list_name in lists_obj){if(!lists_obj.hasOwnProperty(list_name)){continue}this.list_load(list_name,lists_obj[list_name])}},list_remove:function(list_name){if(this.lists.hasOwnProperty(list_name)){delete this.lists[list_name];return true}else{return false}},list_get:function(list_name){if(this.lists.hasOwnProperty(list_name)){return this.lists[list_name]}else{return false}},parse_tag:function(tag){var cmd=tag.slice(1,-1);var list_tags=cmd.split('|');var lists=[];for(var i=0;i<list_tags.length;i+=1){var list={name:list_tags[i],categories:false,replace:false,filter:false};var fns=list.name.split('=');if(fns.length>1){list.name=fns.shift();list.filter=fns}var cats=list.name.split('@');if(cats.length>1){list.name=cats.shift();list.categories=[];for(var n=0;n<cats.length;n+=1){list.categories.push(cats[n])}}if(this.lists.hasOwnProperty(list.name)){if(list.categories){list.replace=this.random_str(this.navigate_obj(this.lists[list.name],list.categories))}else{list.replace=this.random_str(this.lists[list.name])}}if(typeof this.filters[list.name]=='function'){list=this.filters[list.name](list)}if(list.filter){for(var n=0;n<list.filter.length;n+=1){var fn=list.filter[n];if(typeof this.filters[fn]==='function'){list=this.filters[fn](list)}}}lists.push(list)}output=[];for(var i=0;i<lists.length;i+=1){if(lists[i].replace){output.push(lists[i].replace)}}return this.callback.parse_tag({tag:tag,output:(output.length)?this.rai(output):tag,parsed:lists})},parse_template:function(tpl){var tags=tpl.match(/%(.*?)%/g);if(!tags){return tpl}var parsed={template:tpl,parsed_tags:[]};var tags_len=tags.length;for(var i=0;i<tags_len;i+=1){var tag=tags[i];parsed.parsed_tags.push(this.parse_tag(tag))}parsed=this.callback.parse_template(parsed);return parsed},parse:function(tpl){var parsed_tpl=this.parse_template(tpl);if(parsed_tpl.hasOwnProperty('parsed_tags')){for(var i=0;i<parsed_tpl.parsed_tags.length;i+=1){var parsed_tag=parsed_tpl.parsed_tags[i];var clean_tag=new RegExp(parsed_tag.tag.replace(/([\!\$\(\)\*\+\.\/\:\=\?\[\\\]\^\{\|\}])/g,"\\$1"));tpl=tpl.replace(clean_tag,parsed_tag.output)}}parsed_tpl=this.callback.parse(parsed_tpl);this.lists_reset();return tpl},lists_reset:function(){if(this.saved_keys.length){for(var i=this.saved_keys.length-1;i>=0;i-=1){this.list_remove(this.saved_keys[i])}this.saved_keys=[]}if(this.removed_items.length){for(item in this.removed_items){if(!item.hasOwnProperty(item)){continue}if(item.path&&this.lists[item.list_name]instanceof Object){var data=this.navigate_obj(this.lists[item.list_name],item.path);data.splice(item.pos,0,item.str);this.lists[item.list_name]=this.replace_in_obj(this.lists[item.list_name],data,item.path)}else if(this.lists[item.list_name]instanceof Array){this.lists[item.list_name].splice(item.pos,0,item.str)}}}}};